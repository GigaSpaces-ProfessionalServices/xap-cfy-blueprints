tosca_definitions_version: cloudify_dsl_1_1

imports:
  - http://www.getcloudify.org/spec/cloudify/3.2/types.yaml
  - http://www.getcloudify.org/spec/diamond-plugin/1.1/plugin.yaml
  - https://raw.githubusercontent.com/trnvsk/cloudify-host-pool-plugin/1.2-no-delete-queues/plugin.yaml
  - shared/xap.yaml

inputs:
    gsa_gsc:
      description: >
        Number of grid service containers to create on the host
      default: 1

    manager_host_pool_service_endpoint:
      description: >
        URL of host pool service for manager hosts

    gsa_host_pool_service_endpoint:
      description: >
        URL of host pool service for grid hosts

    xap_license_key:
      description: >
        XAP license key to be put into gslicense.xml

    xap_download_url:
      description: >
        Link to XAP installation download

    xap_install_prefix:
      description: >
        Directory to install XAP to
      default: /opt

    network_interface:
      description: >
        Network interface to use to start XAP
      default: eth0

node_templates:
  manager_host:
    type: xap.hostPluginManagerServer
    instances:
      deploy: 2
  manager:
    type: xap_type
    properties:
      xap_license_key: { get_input: xap_license_key }
      xap_download_url: { get_input: xap_download_url }
      xap_install_prefix: { get_input: xap_install_prefix }
      gsa_gsm: 1
      gsa_lus: 1
      network_interface: { get_input: network_interface }
    relationships:
      -  type: cloudify.relationships.contained_in
         target: manager_host
  webui:
    type: xap_webui_type
    properties:
      xap_install_prefix: { get_input: xap_install_prefix }
      webui_port: 9099
      network_interface: { get_input: network_interface }
    relationships:
      -  type: cloudify.relationships.contained_in
         target: manager_host
      -  type: cloudify.relationships.depends_on
         target: manager
  gsa_host:
    type: xap.hostPluginGsaServer
    instances:
      deploy: 2
  gsa:
    type: xap_type
    properties:
      xap_license_key: { get_input: xap_license_key }
      xap_download_url: { get_input: xap_download_url }
      xap_install_prefix: { get_input: xap_install_prefix }
      gsa_gsc: { get_input: gsa_gsc }
      network_interface: { get_input: network_interface }
    relationships:
      -  type: cloudify.relationships.contained_in
         target: gsa_host
      -  type: cloudify.relationships.depends_on
         target: manager
